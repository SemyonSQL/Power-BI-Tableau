Задача: построить дашборд на основании данных, отображающий "промо" продажи и "базовые" продажи. С возможностью фильтрации по бренду, региону и периоду времени.

Данные:  [Массив данных](https://disk.yandex.ru/d/Zx4cUweR9v64TQ)

В таблице присутсвуют продажи разной номенклатуры по точкам продаж в России. При этом массив представляет из себя "сводную таблицу" 
т.к. количество продаж и сумма продаж уже сгруппированы по неделям месяца. 
![git1](https://user-images.githubusercontent.com/107502986/186478362-3217abd8-51e7-4d38-8f3b-e20e1f256bc0.jpg)

Если массив в таком виде импортировать в PowerBI, то фильтрацию по дате делать не получится, потому что даты будут отдельными полями.

![git2](https://user-images.githubusercontent.com/107502986/186480321-94c8a193-2041-4624-ba33-1f2fa16f1cf6.jpg)

Для того чтобы данные по дате отображались корректно, необходимо перевернуть часть массива и подцепить к каждой строчке 96 полей дат. 
Таким образом таблица из 200+ тысяч строк превратится в 19+ миллионов строк. Excel в принципе не поддерживает более 1 млн строк, поэтому обратимся за помощью к SQL.

Разбиваем таблицу на 2 - продажи_штук и продажи_цена преобразуем в .csv и импортируем в локальную БД. 

Далее используя функцию unnest array переворачиваем часть таблицы, получаем половину нужной нам таблицы на 12 млн строк.

![git4](https://user-images.githubusercontent.com/107502986/186484478-51f3ab6b-3020-41f0-95d2-fc3df2dd400e.jpg)

Тоже самое проделываем с таблицей продажи_штук и джойним её с первой по номеклатуре, адресу и дате продажи. (уникальное сочетание)

![git5](https://user-images.githubusercontent.com/107502986/186484969-135cd67a-bfc9-4f61-be77-ed82dd03a463.jpg)

Т.к. у работодателя было требование разделить продажи на промо и базовые, то в соотвествии с указанным в ТЗ алгоритмом делаем дополнительное поле с маркером промо/базовая.
(если цена на 15% ниже стандартной - это промо цена)
Тут для простоты вычислений я использовал максимальную цену по номенклатуре в регионе, сделал такое дополнительное поле

```SQL 
CASE 
  WHEN "цена" < MAX("цена") OVER (PARTITION BY "номенклатура", "регион")*0.85
  THEN "промо"
  ELSE "стандартная цена"
END
```
Также перед экспортом в PowerBI поле даты в формате ГОД_МЕСЯЦ_НЕДЕЛЯ разбил на отдельные поля ГОД,МЕСЯЦ,НЕДЕЛЯ

Далее выгрузил таблицу, опять же, в формате .csv и визуализировал.

![git6](https://user-images.githubusercontent.com/107502986/186487673-e04f6ce8-93ab-4304-9e1f-43aff33851ba.jpg)

